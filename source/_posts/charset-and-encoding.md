---
title: 理清一下编码与字符集
date: 2015-10-25 12:29:14
tags:
---

## 字符集(character set)

字符集(character set)顾名思义是一堆字符的集合。类似的术语还有代码页(code page)、码空间(code space)等等，他们描述的都是相似的东西，但不是完全相同。字符集里面每个字符都有一个独一无二的数字用来表示这个字符，这个数字称为码位(code position)或者码点(code points)。

## 编码(encoding)

编码就是规定字符集中的字符在实际使用中(比如存储、网络传输等等)该如何表示。比如Unicode中的"码"字的码点是`0x7801`，采用utf-8编码时，表现为`\xE5\x93\x88`。也就是中文的"码"字在计算机中使用utf-8编码表示的时候会占用三个字节，三个字节的值分别是`0xE5` `0x93` `0x88`

## 具体例子

- 对于我们常见的 ASCII 标准，因为它直接规定了每个字符使用一个7位二进制码来表示，包含128个字符。所以它既是字符集，也是编码
- 中文常见 gb 2312 标准，它本身采用区位码形式的字符集标准(这个标准规定每个字符使用一个4位十进制数字表示码点)，实际使用中只使用采用EUC-CN来编码。但我们一般提起 gb 2312 时，也默认当做一个字符集和编码的连锁方案。
- Unicode 本身是一个字符集，它有很多编码方案：utf-8、utf-16、utf-32

## Windows 记事本

- Windows 记事本中所说的ANSI编码是指当前系统中的采用的默认编码，比如中文 Windows 对应的 GBK 编码。
- Unicode 指的是带有BOM的小端序 utf-16
- utf-8 指的是带BOM的 utf-8

所谓的ANSI编码会随着Windows的区域设置不同而变化。比如中文Windows下用ANSI编码保存的文件放在日文Windows下就会出现乱码。

## 什么是BOM

BOM(byte-order mark)全称是字节顺序标记，属于Unicode标准的一部分。BOM出现在字节流开头，用来解释当前字节流的编码。

- 0xFF 0xFE 是UTF-16 小端序
- 0xFE 0xFF 是UTF-16 大端序
- 0xEF 0xBB 0xBF 是UTF-8

顺便解释一下端序，大端序指的是高位字节存储在内存的低地址处，而低位字节存储在内存的高地址处。而小端序值高位字节存储在内存的高地址处，而低位字节存储在内存的低地址处。

## 为什么utf-8不需要BOM

因为utf-8可以根据每个字符的第一个字节的前四位来判断这个字符占用多少个字节。

- 对于UTF-8编码中的任意字节B，如果B的第一位为0，则B为ASCI码，并且B独立的表示一个字符
- 如果B的第一位为1，第二位为0，则B为一个非ASCII字符（该字符由多个字节表示）中的一个字节，并且不是字符的第一个字节编码
- 如果B的前两位为1，第三位为0，则B为一个非ASCII字符（该字符由多个字节表示）中的第一个字节，并且该字符由两个字节表示
- 如果B的前三位为1，第四位为0，则B为一个非ASCII字符（该字符由多个字节表示）中的第一个字节，并且该字符由三个字节表示
- 如果B的前四位为1，第五位为0，则B为一个非ASCII字符（该字符由多个字节表示）中的第一个字节，并且该字符由四个字节表示

